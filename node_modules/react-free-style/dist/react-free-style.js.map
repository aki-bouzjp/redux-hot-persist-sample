{"version":3,"file":"react-free-style.js","sourceRoot":"","sources":["../src/react-free-style.ts"],"names":[],"mappings":"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","sourcesContent":["import React = require('react')\nimport * as FreeStyle from 'free-style'\nimport * as helpers from 'style-helper'\n\n/**\n * Re-export the `free-style` module.\n */\nexport { FreeStyle, helpers }\n\n/**\n * Tag the element for rendering later.\n */\nexport const STYLE_ID = '_react_free_style_'\n\n/**\n * Check whether we can render on the server/browser.\n */\nexport const canUseDOM = !!(\n  typeof (window as any) !== 'undefined' &&\n  window.document &&\n  window.document.createElement\n)\n\n/**\n * Create a new \"global\" instance.\n */\nfunction createGlobal () {\n  // Skip DOM lookup.\n  if (!canUseDOM) return FreeStyle.create()\n\n  let element = document.getElementById(STYLE_ID) as HTMLStyleElement\n  let styleSheet: CSSStyleSheet\n\n  if (!element) {\n    element = document.createElement('style')\n    element.setAttribute('id', STYLE_ID)\n    element.setAttribute('type', 'text/css')\n    document.head.appendChild(element)\n  }\n\n  for (let i = 0; i < document.styleSheets.length; i++) {\n    const item = document.styleSheets.item(i)\n\n    if (item.ownerNode === element) {\n      styleSheet = item as CSSStyleSheet\n      break\n    }\n  }\n\n  return FreeStyle.create(undefined, undefined, {\n    add (style, index) {\n      styleSheet.insertRule(style.getStyles(), index)\n    },\n    remove (style, index) {\n      styleSheet.deleteRule(index)\n    },\n    change (style, oldIndex, newIndex) {\n      styleSheet.deleteRule(oldIndex)\n      styleSheet.insertRule(style.getStyles(), newIndex)\n    }\n  })\n}\n\n/**\n * Create a global style container.\n */\nlet globalStyle = createGlobal()\n\n/**\n * Create and append a style element to the DOM.\n */\nconst addStyle = (Style: FreeStyle.FreeStyle) => {\n  const global = globalStyle\n  global.merge(Style)\n\n  return () => { global.unmerge(Style) }\n}\n\n/**\n * Object used for dynamic styles over the context.\n */\nexport type StyleContext = Pick<\n  FreeStyle.FreeStyle,\n  'registerStyle' | 'registerCss' | 'registerHashRule' | 'registerKeyframes' | 'registerRule'\n> & { unmount (): void }\n\n/**\n * Create the context object for style components.\n */\nexport function createStyleContext (componentName: string): StyleContext {\n  const Style: FreeStyle.FreeStyle = FreeStyle.create()\n  let unmount = addStyle(Style)\n\n  function wrap <T> (invoke: () => T): T {\n    const result = invoke()\n    unmount()\n    unmount = addStyle(Style)\n    return result\n  }\n\n  return {\n    registerStyle (styles: FreeStyle.Styles, displayName?: string) {\n      const debugName = displayName ? `${componentName}_${displayName}` : componentName\n      return wrap(() => Style.registerStyle(styles, debugName))\n    },\n    registerHashRule (prefix: string, styles: FreeStyle.Styles, displayName?: string) {\n      const debugName = displayName ? `${componentName}_${displayName}` : componentName\n      return wrap(() => Style.registerHashRule(prefix, styles, debugName))\n    },\n    registerKeyframes (keyframes: FreeStyle.Styles, displayName?: string) {\n      const debugName = displayName ? `${componentName}_${displayName}` : componentName\n      return wrap(() => Style.registerKeyframes(keyframes, debugName))\n    },\n    registerRule (rule: string, styles: FreeStyle.Styles) {\n      return wrap(() => Style.registerRule(rule, styles))\n    },\n    registerCss (css: FreeStyle.Styles) {\n      return wrap(() => Style.registerCss(css))\n    },\n    unmount () {\n      return unmount()\n    }\n  }\n}\n\n/**\n * Get the current render styles.\n */\nexport function rewind () {\n  if (canUseDOM) {\n    throw new TypeError('You must call `rewind()` on the server. Call `peek()` to read the current styles.')\n  }\n\n  const styles = peek()\n  globalStyle = createGlobal()\n  return styles\n}\n\n/**\n * The interface for \"peeking\" results.\n */\nexport class Peek {\n  constructor (public Style: FreeStyle.FreeStyle) {}\n\n  toComponent () {\n    return React.createElement('style', {\n      id: STYLE_ID,\n      dangerouslySetInnerHTML: { __html: this.Style.getStyles() }\n    })\n  }\n\n  toString () {\n    return `<style id=\"${STYLE_ID}\">${this.Style.getStyles()}</style>`\n  }\n\n  toCss () {\n    return this.Style.getStyles()\n  }\n}\n\n/**\n * Peek at the current styles without clearing.\n */\nexport function peek (): Peek {\n  return new Peek(globalStyle)\n}\n\n/**\n * Style component properties.\n */\nexport interface StyleComponentProps <P> {\n  Style: FreeStyle.FreeStyle\n  Component: React.ComponentType<P>\n  componentName: string\n  componentProps: P\n  withFreeStyle?: boolean\n}\n\n/**\n * Create a style component.\n */\nexport class StyleComponent extends React.Component<StyleComponentProps<any>, {}> {\n\n  static displayName = 'Style'\n\n  freeStyle?: StyleContext\n  unmountStyle: () => void\n\n  componentWillMount () {\n    this.unmountStyle = addStyle(this.props.Style)\n  }\n\n  componentWillUpdate (nextProps: StyleComponentProps<any>) {\n    if (this.props.Style.id === nextProps.Style.id) return\n\n    this.unmountStyle()\n    this.unmountStyle = addStyle(nextProps.Style)\n  }\n\n  componentWillUnmount () {\n    this.unmountStyle()\n    if (this.freeStyle) this.freeStyle.unmount()\n  }\n\n  render () {\n    const { componentProps, Component, withFreeStyle } = this.props\n    const props = withFreeStyle ? Object.assign({}, componentProps, {\n      freeStyle: this.freeStyle || (this.freeStyle = createStyleContext(this.props.componentName))\n    }) : componentProps\n\n    return React.createElement(Component as any, props)\n  }\n\n}\n\n/**\n * Wrap a component instead of adding it to the markup manually.\n */\nexport function wrap <P, U> (\n  Component: React.ComponentType<U>,\n  Style: FreeStyle.FreeStyle,\n  withFreeStyle?: boolean,\n  name = 'anonymous'\n) {\n  const componentName = Component.displayName || Component.name || name\n\n  const Wrapped: React.StatelessComponent<P> = (componentProps: P) => {\n    return React.createElement(\n      StyleComponent,\n      { Style, Component, componentName, componentProps, withFreeStyle }\n    )\n  }\n\n  Wrapped.displayName = `Wrap(${componentName}, Style)`\n\n  return Wrapped\n}\n\n/**\n * Props passed through to the component.\n */\nexport type StyledProps <T extends string> = {\n  styles?: helpers.StyleMap<T>\n}\n\n/**\n * Props provided by the `styled` wrapper.\n */\nexport type StyledComponentProps <T extends string> = {\n  styles: helpers.StyleMap<T>\n  freeStyle?: StyleContext\n}\n\n/**\n * Create a HOC for styles.\n */\nexport function styled <T extends string> (\n  sheet: helpers.StyleSheet<T> = {} as helpers.StyleSheet<T>,\n  options?: helpers.Options<T>,\n  hash?: FreeStyle.HashFunction,\n  debug?: boolean\n) {\n  return <P> (\n    Component: React.ComponentType<P & StyledComponentProps<T>>,\n    withFreeStyle?: boolean\n  ) => {\n    const Style = FreeStyle.create(hash, debug)\n    const componentName = Component.displayName || Component.name || 'anonymous'\n    const styles = helpers.registerStyleSheet(Style, sheet, options, componentName)\n    const displayName = `Styled(${componentName})`\n\n    return Object.assign(\n      ((props: P & StyledProps<T>) => {\n        const componentProps = Object.assign({}, props, {\n          styles: props.styles ? Object.assign({}, styles, props.styles) : styles\n        })\n\n        return React.createElement(\n          StyleComponent,\n          { Style, Component, componentName, componentProps, withFreeStyle }\n        )\n      }) as React.StatelessComponent<P>,\n      { displayName, styles, Style }\n    )\n  }\n}\n"]}